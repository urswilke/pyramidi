---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pyramidi

<!-- badges: start -->
<!-- badges: end -->

The goal of pyramidi is to read in dataframes generated by the python package
miditapyr. These dataframes contain midi data. Then the midi information (one
line per event) can be translated into a wide format (one line per note). This 
facilitates plotting piano roll plots. These dataframes can then be written back
to midi files (again using miditapyr).

## Installation

You can install the released version of pyramidi from [github](https://github.com/urswilke/pyramidi) with:

``` r
## install remotes package if it's not already
if (!requireNamespace("remotes", quietly = TRUE)) {
  install.packages("remotes")
}

## install dev version of rtweettree from github
remotes::install_github("UrsWilke/pyramidi")
```

## Basic usage

### Extract midi file information into a dataframe

```{r midi_df}
library(pyramidi)
library(zeallot)
mid_file <- '/home/chief/Bitwig Studio/Projects/bossa_raw/midi_arpeggiated.mid'
mt <- reticulate::import("miditapyr")
mido <- reticulate::import("mido")
 
mido$MidiFile(mid_file) %>%
  mt$mido_midi_df()  %->% c(df_meta, df_notes, ticks_per_beat)
df_notes_wide <-  
  tab_measures(df_meta, df_notes, ticks_per_beat) %>%
  widen_events() %>%
  dplyr::left_join(pyramidi::midi_defs)
df_notes_wide
```

### Plot the midi file information in a piano roll plot

```{r midi_piano roll}
p1 <- df_notes_wide %>%
  ggplot2::ggplot() +
  ggplot2::geom_segment(ggplot2::aes(x = m_note_on,
                                     y = note_name,
                                     xend = m_note_off,
                                     yend = note_name,
                                     color = velocity_note_on)) +
# each midi track is printed into its own facet
  ggplot2::facet_wrap(~ i_track,
                      ncol=1,
                      scales = "free_y")
p1

```


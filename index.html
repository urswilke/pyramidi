<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read &amp; Write Midi Data via Python and Manipulate in R • pyramidi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Read &amp; Write Midi Data via Python and Manipulate in R">
<meta property="og:description" content="Import the python libraries miditapyr and mido to read in midi file data in pandas DataFrames. These can then be imported in R via reticulate. The event-based midi data is widened to facilitate the manipulation and plotting of note-based structures as in music21. The data frame format allows for an easy implementation of many music data manipulations.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">pyramidi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/tuner.html">Using the tuneR package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/urswilke/pyramidi/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="pyramidi-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#pyramidi-" class="anchor"></a>pyramidi <a href="https://github.com/urswilke/pyramidi/"><img src="reference/figures/hex_logo_pyramidi.png" align="right" height="139"></a>
</h1></div>
<!-- badges: start -->

<p><strong>Work in progress!</strong></p>
<p>♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬ ♪ ♫ ♩ ♬</p>
<p>The goal of pyramidi is to read in dataframes generated by the python package <a href="https://pypi.org/project/miditapyr/">miditapyr</a>. These dataframes contain midi data. Then the midi information (one line per event) can be translated into a wide format (one line per note). This facilitates plotting piano roll plots. These dataframes can then be written back to midi files (again using miditapyr).</p>
<p>Thus you can manipulate these dataframes at all steps and write midi files from R. You need to make sure yourself that the midi files you write can be understood by your softsynth; but <a href="https://github.com/mido/mido">mido</a> (used by miditapyr) already catches some of the possible inconsistencies.</p>
<p><em>I started to write these packages quite some time ago. They are sometimes not very well designed. For now <code>miditapyr</code> only contains one module with functions. And the functionality of <code>pyramidi</code> is quite limited and necessitates a lot of manual intermediate steps. But the loose structure allows you to generate &amp; manipulate midi data on many different levels.</em></p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install pyramidi from <a href="https://github.com/urswilke/pyramidi">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## install remotes package if it's not already</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">## install dev version of rtweettree from github</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"UrsWilke/pyramidi"</span><span class="op">)</span></code></pre></div>
<p>The python package <a href="https://pypi.org/project/miditapyr/">miditapyr</a> also needs to be installed via</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">pip</span> install miditapyr</span></code></pre></div>
<p>in your python environment used by <a href="https://github.com/rstudio/reticulate">reticulate</a>.</p>
<p>But if everything works as it should 🤞😅, miditapyr is automatically installed if you install pyramidi, as soon as you access the module for the first time.</p>
<p>Otherwise, you can also install it in your reticulate python environment with the included helper function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pyramidi</span><span class="fu">::</span><span class="fu"><a href="reference/install_miditapyr.html">install_miditapyr</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="basic-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic usage</h2>
<div id="load-libraries" class="section level3">
<h3 class="hasAnchor">
<a href="#load-libraries" class="anchor"></a>Load libraries</h3>
<p>First load some libraries:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/urswilke/pyramidi">pyramidi</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nteetor/zeallot">zeallot</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="extract-midi-file-information-into-dataframe" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-midi-file-information-into-dataframe" class="anchor"></a>Extract midi file information into dataframe</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">midi_file_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_midi_file.mid"</span>, package <span class="op">=</span> <span class="st">"pyramidi"</span><span class="op">)</span>

<span class="va">midifile</span> <span class="op">&lt;-</span> <span class="va">mido</span><span class="op">$</span><span class="fu">MidiFile</span><span class="op">(</span><span class="va">midi_file_str</span><span class="op">)</span>
<span class="va">ticks_per_beat</span> <span class="op">&lt;-</span> <span class="va">midifile</span><span class="op">$</span><span class="va">ticks_per_beat</span></code></pre></div>
<p>Now we can load the information of the <code>midifile</code> into a dataframe:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfc</span> <span class="op">=</span> <span class="va">miditapyr</span><span class="op">$</span><span class="fu">midi_to_df</span><span class="op">(</span><span class="va">midifile</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dfc</span>, <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt;    i_track  meta                            msg</span>
<span class="co">#&gt; 1        0  TRUE    track_name, drum-t1-1-t1, 0</span>
<span class="co">#&gt; 2        0 FALSE          note_on, 0, 43, 72, 9</span>
<span class="co">#&gt; 3        0 FALSE          note_on, 0, 39, 64, 9</span>
<span class="co">#&gt; 4        0 FALSE         note_on, 0, 36, 101, 9</span>
<span class="co">#&gt; 5        0  TRUE           set_tempo, 666666, 0</span>
<span class="co">#&gt; 6        0  TRUE time_signature, 4, 4, 24, 8, 0</span>
<span class="co">#&gt; 7        0 FALSE       note_off, 240, 43, 72, 9</span>
<span class="co">#&gt; 8        0 FALSE         note_off, 0, 39, 64, 9</span>
<span class="co">#&gt; 9        0 FALSE        note_off, 0, 36, 101, 9</span>
<span class="co">#&gt; 10       0 FALSE       note_on, 240, 42, 101, 9</span>
<span class="co">#&gt; 11       0 FALSE         note_on, 0, 38, 101, 9</span>
<span class="co">#&gt; 12       0 FALSE        note_on, 240, 43, 64, 9</span>
<span class="co">#&gt; 13       0 FALSE        note_off, 0, 42, 101, 9</span>
<span class="co">#&gt; 14       0 FALSE        note_off, 0, 38, 101, 9</span>
<span class="co">#&gt; 15       0 FALSE       note_off, 240, 43, 64, 9</span>
<span class="co">#&gt; 16       0 FALSE         note_on, 0, 36, 101, 9</span>
<span class="co">#&gt; 17       0 FALSE      note_off, 240, 36, 101, 9</span>
<span class="co">#&gt; 18       0 FALSE        note_on, 240, 43, 60, 9</span>
<span class="co">#&gt; 19       0 FALSE         note_on, 0, 42, 101, 9</span>
<span class="co">#&gt; 20       0 FALSE       note_off, 240, 43, 60, 9</span></code></pre></div>
<p>This dataframe contains the columns of the track index <code>i_track</code>, <code>meta</code> (whether the midi event is a note event), and <code>msg</code> containing named lists of further midi event information.</p>
<p>The <code>MidiFile()</code> function of <code>mido</code> also yields the <a href="https://mido.readthedocs.io/en/latest/midi_files.html#tempo-and-beat-resolution"><code>ticks_per_beat</code></a> of the file:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ticks_per_beat</span>
<span class="co">#&gt; [1] 960</span></code></pre></div>
<p>The <code>miditapyr$tidy_df()</code> function transforms the <code>msg</code> column of the dataframe to a wide format, where every new column name corresponds to the names in the lists in <code>msg</code> (like <code><a href="https://tidyr.tidyverse.org/reference/hoist.html">tidyr::unnest_wider()</a></code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">miditapyr</span><span class="op">$</span><span class="fu">tidy_df</span><span class="op">(</span><span class="va">dfc</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 × 13</span>
<span class="co">#&gt;    i_track meta  type       name    time  note velocity channel  tempo numerator</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;      &lt;list&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1       0 TRUE  track_name &lt;chr …     0   NaN      NaN     NaN    NaN       NaN</span>
<span class="co">#&gt;  2       0 FALSE note_on    &lt;dbl …     0    43       72       9    NaN       NaN</span>
<span class="co">#&gt;  3       0 FALSE note_on    &lt;dbl …     0    39       64       9    NaN       NaN</span>
<span class="co">#&gt;  4       0 FALSE note_on    &lt;dbl …     0    36      101       9    NaN       NaN</span>
<span class="co">#&gt;  5       0 TRUE  set_tempo  &lt;dbl …     0   NaN      NaN     NaN 666666       NaN</span>
<span class="co">#&gt;  6       0 TRUE  time_sign… &lt;dbl …     0   NaN      NaN     NaN    NaN         4</span>
<span class="co">#&gt;  7       0 FALSE note_off   &lt;dbl …   240    43       72       9    NaN       NaN</span>
<span class="co">#&gt;  8       0 FALSE note_off   &lt;dbl …     0    39       64       9    NaN       NaN</span>
<span class="co">#&gt;  9       0 FALSE note_off   &lt;dbl …     0    36      101       9    NaN       NaN</span>
<span class="co">#&gt; 10       0 FALSE note_on    &lt;dbl …   240    42      101       9    NaN       NaN</span>
<span class="co">#&gt; 11       0 FALSE note_on    &lt;dbl …     0    38      101       9    NaN       NaN</span>
<span class="co">#&gt; 12       0 FALSE note_on    &lt;dbl …   240    43       64       9    NaN       NaN</span>
<span class="co">#&gt; 13       0 FALSE note_off   &lt;dbl …     0    42      101       9    NaN       NaN</span>
<span class="co">#&gt; 14       0 FALSE note_off   &lt;dbl …     0    38      101       9    NaN       NaN</span>
<span class="co">#&gt; 15       0 FALSE note_off   &lt;dbl …   240    43       64       9    NaN       NaN</span>
<span class="co">#&gt; 16       0 FALSE note_on    &lt;dbl …     0    36      101       9    NaN       NaN</span>
<span class="co">#&gt; 17       0 FALSE note_off   &lt;dbl …   240    36      101       9    NaN       NaN</span>
<span class="co">#&gt; 18       0 FALSE note_on    &lt;dbl …   240    43       60       9    NaN       NaN</span>
<span class="co">#&gt; 19       0 FALSE note_on    &lt;dbl …     0    42      101       9    NaN       NaN</span>
<span class="co">#&gt; 20       0 FALSE note_off   &lt;dbl …   240    43       60       9    NaN       NaN</span>
<span class="co">#&gt; # … with 3 more variables: denominator &lt;dbl&gt;, clocks_per_click &lt;dbl&gt;,</span>
<span class="co">#&gt; #   notated_32nd_notes_per_beat &lt;dbl&gt;</span></code></pre></div>
<p>Except the <code>name</code> column this seems to be the same as</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfc</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> <span class="fu">unnest_wider</span><span class="op">(</span><span class="va">msg</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 268 × 13</span>
<span class="co">#&gt;    i_track meta  type      name     time  note velocity channel  tempo numerator</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;   &lt;int&gt;  &lt;int&gt;     &lt;int&gt;</span>
<span class="co">#&gt;  1       0 TRUE  track_na… drum-t…     0    NA       NA      NA     NA        NA</span>
<span class="co">#&gt;  2       0 FALSE note_on   &lt;NA&gt;        0    43       72       9     NA        NA</span>
<span class="co">#&gt;  3       0 FALSE note_on   &lt;NA&gt;        0    39       64       9     NA        NA</span>
<span class="co">#&gt;  4       0 FALSE note_on   &lt;NA&gt;        0    36      101       9     NA        NA</span>
<span class="co">#&gt;  5       0 TRUE  set_tempo &lt;NA&gt;        0    NA       NA      NA 666666        NA</span>
<span class="co">#&gt;  6       0 TRUE  time_sig… &lt;NA&gt;        0    NA       NA      NA     NA         4</span>
<span class="co">#&gt;  7       0 FALSE note_off  &lt;NA&gt;      240    43       72       9     NA        NA</span>
<span class="co">#&gt;  8       0 FALSE note_off  &lt;NA&gt;        0    39       64       9     NA        NA</span>
<span class="co">#&gt;  9       0 FALSE note_off  &lt;NA&gt;        0    36      101       9     NA        NA</span>
<span class="co">#&gt; 10       0 FALSE note_on   &lt;NA&gt;      240    42      101       9     NA        NA</span>
<span class="co">#&gt; # … with 258 more rows, and 3 more variables: denominator &lt;int&gt;,</span>
<span class="co">#&gt; #   clocks_per_click &lt;int&gt;, notated_32nd_notes_per_beat &lt;int&gt;</span></code></pre></div>
</div>
<div id="translate-midi-time-information" class="section level3">
<h3 class="hasAnchor">
<a href="#translate-midi-time-information" class="anchor"></a>Translate midi time information</h3>
<p>In the midi format, time is treated as relative increments between events (measured in ticks). In order to derive the total time passed, you can use the function <code><a href="reference/tab_measures.html">tab_measures()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tab_measures.html">tab_measures</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">ticks_per_beat</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># create a variable `track` with the track name (in order to have it in the plot below)</span>
  <span class="fu">mutate</span><span class="op">(</span>track <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">typeof</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"character"</span>, 
                        <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NA_character_</span><span class="op">)</span>, 
                        <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">track</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu">fill</span><span class="op">(</span><span class="va">track</span><span class="op">)</span>

<span class="va">dfm</span>
<span class="co">#&gt; # A tibble: 268 × 19</span>
<span class="co">#&gt;    i_track meta  type       name    time  note velocity channel  tempo numerator</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;      &lt;list&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1       0 TRUE  track_name &lt;chr …     0   NaN      NaN     NaN    NaN       NaN</span>
<span class="co">#&gt;  2       0 FALSE note_on    &lt;dbl …     0    43       72       9    NaN       NaN</span>
<span class="co">#&gt;  3       0 FALSE note_on    &lt;dbl …     0    39       64       9    NaN       NaN</span>
<span class="co">#&gt;  4       0 FALSE note_on    &lt;dbl …     0    36      101       9    NaN       NaN</span>
<span class="co">#&gt;  5       0 TRUE  set_tempo  &lt;dbl …     0   NaN      NaN     NaN 666666       NaN</span>
<span class="co">#&gt;  6       0 TRUE  time_sign… &lt;dbl …     0   NaN      NaN     NaN    NaN         4</span>
<span class="co">#&gt;  7       0 FALSE note_off   &lt;dbl …   240    43       72       9    NaN       NaN</span>
<span class="co">#&gt;  8       0 FALSE note_off   &lt;dbl …     0    39       64       9    NaN       NaN</span>
<span class="co">#&gt;  9       0 FALSE note_off   &lt;dbl …     0    36      101       9    NaN       NaN</span>
<span class="co">#&gt; 10       0 FALSE note_on    &lt;dbl …   240    42      101       9    NaN       NaN</span>
<span class="co">#&gt; # … with 258 more rows, and 9 more variables: denominator &lt;dbl&gt;,</span>
<span class="co">#&gt; #   clocks_per_click &lt;dbl&gt;, notated_32nd_notes_per_beat &lt;dbl&gt;, ticks &lt;dbl&gt;,</span>
<span class="co">#&gt; #   t &lt;dbl&gt;, m &lt;dbl&gt;, b &lt;dbl&gt;, i_note &lt;int&gt;, track &lt;chr&gt;</span></code></pre></div>
<p>This function adds further columns:</p>
<ul>
<li>
<code>ticks</code>: specifying the total ticks passed,</li>
<li>
<code>t</code>: specifying the total time in seconds passed,</li>
<li>
<code>m</code>: specifying the total <a href="https://en.wikipedia.org/wiki/Bar_(music)">measures</a> passed,</li>
<li>
<code>b</code>: specifying the total <a href="https://en.wikipedia.org/wiki/Beat_(music)">beats</a> passed,</li>
<li>
<code>i_note</code>: unique ascending index for every track and midi note in the midi file.</li>
</ul>
</div>
<div id="further-processing-of-the-midi-events" class="section level3">
<h3 class="hasAnchor">
<a href="#further-processing-of-the-midi-events" class="anchor"></a>Further processing of the midi events</h3>
<p>You can split the dataframe in two by whether the events are <a href="https://mido.readthedocs.io/en/latest/meta_message_types.html">meta</a> or not:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfm</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> 
    <span class="va">miditapyr</span><span class="op">$</span><span class="fu">split_df</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html">%-&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">df_meta</span>, <span class="va">df_notes</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_meta</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 16</span>
<span class="co">#&gt;   i_track meta  type   name   time  tempo numerator denominator clocks_per_click</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;  &lt;lis&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1       0 TRUE  track… &lt;chr…     0    NaN       NaN         NaN              NaN</span>
<span class="co">#&gt; 2       0 TRUE  set_t… &lt;dbl…     0 666666       NaN         NaN              NaN</span>
<span class="co">#&gt; 3       0 TRUE  time_… &lt;dbl…     0    NaN         4           4               24</span>
<span class="co">#&gt; 4       0 TRUE  end_o… &lt;dbl…     1    NaN       NaN         NaN              NaN</span>
<span class="co">#&gt; 5       1 TRUE  track… &lt;chr…     0    NaN       NaN         NaN              NaN</span>
<span class="co">#&gt; 6       1 TRUE  end_o… &lt;dbl…     1    NaN       NaN         NaN              NaN</span>
<span class="co">#&gt; 7       2 TRUE  track… &lt;chr…     0    NaN       NaN         NaN              NaN</span>
<span class="co">#&gt; 8       2 TRUE  end_o… &lt;dbl…     1    NaN       NaN         NaN              NaN</span>
<span class="co">#&gt; # … with 7 more variables: notated_32nd_notes_per_beat &lt;dbl&gt;, ticks &lt;dbl&gt;,</span>
<span class="co">#&gt; #   t &lt;dbl&gt;, m &lt;dbl&gt;, b &lt;dbl&gt;, i_note &lt;int&gt;, track &lt;chr&gt;</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_notes</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 260 × 13</span>
<span class="co">#&gt;    i_track meta  type      time  note velocity channel ticks     t     m     b</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1       0 FALSE note_on      0    43       72       9     0 0      0        0</span>
<span class="co">#&gt;  2       0 FALSE note_on      0    39       64       9     0 0      0        0</span>
<span class="co">#&gt;  3       0 FALSE note_on      0    36      101       9     0 0      0        0</span>
<span class="co">#&gt;  4       0 FALSE note_off   240    43       72       9   240 0.167  0.25     1</span>
<span class="co">#&gt;  5       0 FALSE note_off     0    39       64       9   240 0.167  0.25     1</span>
<span class="co">#&gt;  6       0 FALSE note_off     0    36      101       9   240 0.167  0.25     1</span>
<span class="co">#&gt;  7       0 FALSE note_on    240    42      101       9   480 0.333  0.5      2</span>
<span class="co">#&gt;  8       0 FALSE note_on      0    38      101       9   480 0.333  0.5      2</span>
<span class="co">#&gt;  9       0 FALSE note_on    240    43       64       9   720 0.500  0.75     3</span>
<span class="co">#&gt; 10       0 FALSE note_off     0    42      101       9   720 0.500  0.75     3</span>
<span class="co">#&gt; # … with 250 more rows, and 2 more variables: i_note &lt;int&gt;, track &lt;chr&gt;</span></code></pre></div>
</div>
<div id="pivot-note-dataframe-to-wide" class="section level3">
<h3 class="hasAnchor">
<a href="#pivot-note-dataframe-to-wide" class="anchor"></a>Pivot note dataframe to wide</h3>
<p>Each note in the midi file is characterized by a <code>note_on</code> and a <code>note_off</code> event. In order to generate a piano roll plot with ggplot2, we need to <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">tidyr::pivot_wider()</a></code> those events. This can be done with the function <code><a href="reference/widen_events.html">widen_events()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_not_notes</span> <span class="op">&lt;-</span> 
  <span class="va">df_notes</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">type</span>, <span class="st">"^note_o[nf]f?$"</span><span class="op">)</span><span class="op">)</span> 

<span class="va">df_notes_wide</span> <span class="op">&lt;-</span>
  <span class="va">df_notes</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">type</span>, <span class="st">"^note_o[nf]f?$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># tab_measures(df_meta, df_notes, ticks_per_beat) %&gt;%</span>
  <span class="fu"><a href="reference/widen_events.html">widen_events</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">left_join</span><span class="op">(</span><span class="fu">pyramidi</span><span class="fu">::</span><span class="va"><a href="reference/midi_defs.html">midi_defs</a></span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "note"</span>
<span class="va">df_notes_wide</span>
<span class="co">#&gt; # A tibble: 130 × 19</span>
<span class="co">#&gt;    i_track meta   note channel i_note track        time_note_on time_note_off</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt;               &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt;  1       0 FALSE    43       9      1 drum-t1-1-t1            0           240</span>
<span class="co">#&gt;  2       0 FALSE    39       9      1 drum-t1-1-t1            0             0</span>
<span class="co">#&gt;  3       0 FALSE    36       9      1 drum-t1-1-t1            0             0</span>
<span class="co">#&gt;  4       0 FALSE    42       9      1 drum-t1-1-t1          240             0</span>
<span class="co">#&gt;  5       0 FALSE    38       9      1 drum-t1-1-t1            0             0</span>
<span class="co">#&gt;  6       0 FALSE    43       9      2 drum-t1-1-t1          240           240</span>
<span class="co">#&gt;  7       0 FALSE    36       9      2 drum-t1-1-t1            0           240</span>
<span class="co">#&gt;  8       0 FALSE    43       9      3 drum-t1-1-t1          240           240</span>
<span class="co">#&gt;  9       0 FALSE    42       9      2 drum-t1-1-t1            0             0</span>
<span class="co">#&gt; 10       0 FALSE    43       9      4 drum-t1-1-t1          240           240</span>
<span class="co">#&gt; # … with 120 more rows, and 11 more variables: velocity_note_on &lt;dbl&gt;,</span>
<span class="co">#&gt; #   velocity_note_off &lt;dbl&gt;, ticks_note_on &lt;dbl&gt;, ticks_note_off &lt;dbl&gt;,</span>
<span class="co">#&gt; #   t_note_on &lt;dbl&gt;, t_note_off &lt;dbl&gt;, m_note_on &lt;dbl&gt;, m_note_off &lt;dbl&gt;,</span>
<span class="co">#&gt; #   b_note_on &lt;dbl&gt;, b_note_off &lt;dbl&gt;, note_name &lt;fct&gt;</span></code></pre></div>
<p>In the new format, the data has half the number of rows. The columns <code>m</code>, <code>b</code>, <code>t</code>, <code>ticks</code>, <code>time</code> and <code>velocity</code> are each replaced by two columns with the suffix <code>_note_on</code> and <code>_note_off</code>.</p>
</div>
<div id="plot-the-midi-file-information-in-a-piano-roll-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-the-midi-file-information-in-a-piano-roll-plot" class="anchor"></a>Plot the midi file information in a piano roll plot</h3>
<p>Now we have the midi data in the right format for the piano roll plot:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_notes_wide</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">m_note_on</span>,
      y <span class="op">=</span> <span class="va">note_name</span>,
      xend <span class="op">=</span> <span class="va">m_note_off</span>,
      yend <span class="op">=</span> <span class="va">note_name</span>,
      color <span class="op">=</span> <span class="va">velocity_note_on</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="co"># each midi track is printed into its own facet:</span>
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">track</span>,
              ncol <span class="op">=</span> <span class="fl">1</span>,
              scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">guides</span><span class="op">(</span>color<span class="op">=</span><span class="fu">guide_colorbar</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Note velocity"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Piano roll of the note events in the midi file"</span>,
    subtitle <span class="op">=</span> <span class="st">"Only notes played are shown."</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Measures"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">16</span>, <span class="fl">4</span><span class="op">)</span>,
                     minor_breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_colour_gradient</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-midi_piano_roll-1.png" width="100%"></p>
</div>
<div id="manipulation-of-the-midi-data" class="section level3">
<h3 class="hasAnchor">
<a href="#manipulation-of-the-midi-data" class="anchor"></a>Manipulation of the midi data</h3>
<p>The new format also allows to easily manipulate the midi data. For instance, let’s put the volume (called <code>velocity</code> in midi) of the first beat in every bar to the maximum (127), and to half of its original value otherwise:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_notes_wide_mod</span> <span class="op">&lt;-</span> <span class="va">df_notes_wide</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu">mutate</span><span class="op">(</span>
    velocity_note_on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>
      <span class="co"># As it's a 4/4 beat, the first beat of each bar is a multiple of 4:</span>
      <span class="va">b_note_on</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">4</span> <span class="op">==</span> <span class="fl">0</span>, 
      <span class="fl">127</span>, 
      <span class="va">velocity_note_on</span> <span class="op">/</span> <span class="fl">2</span>
    <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s compare the modified value to the original one:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span>
  old <span class="op">=</span> <span class="va">df_notes_wide</span><span class="op">$</span><span class="va">velocity_note_on</span>,
  new <span class="op">=</span> <span class="va">df_notes_wide_mod</span><span class="op">$</span><span class="va">velocity_note_on</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 130 × 2</span>
<span class="co">#&gt;      old   new</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1    72 127  </span>
<span class="co">#&gt;  2    64 127  </span>
<span class="co">#&gt;  3   101 127  </span>
<span class="co">#&gt;  4   101  50.5</span>
<span class="co">#&gt;  5   101  50.5</span>
<span class="co">#&gt;  6    64  32  </span>
<span class="co">#&gt;  7   101 127  </span>
<span class="co">#&gt;  8    60  30  </span>
<span class="co">#&gt;  9   101  50.5</span>
<span class="co">#&gt; 10    60 127  </span>
<span class="co">#&gt; # … with 120 more rows</span></code></pre></div>
</div>
<div id="pivot-note-data-frame-back-to-long-format" class="section level3">
<h3 class="hasAnchor">
<a href="#pivot-note-data-frame-back-to-long-format" class="anchor"></a>Pivot note data frame back to long format</h3>
<p>We can transform the wide midi data back to the long format:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_notes_out</span> <span class="op">&lt;-</span>
  <span class="va">df_notes_wide</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"i_track"</span>,
           <span class="st">"channel"</span>, <span class="st">"note"</span>, <span class="st">"i_note"</span><span class="op">)</span>, <span class="fu">matches</span><span class="op">(</span><span class="st">"_note_o[nf]f?$"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">matches</span><span class="op">(</span><span class="st">"_note_o[nf]f?$"</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">".value"</span>, <span class="st">"type"</span><span class="op">)</span>,
               names_pattern <span class="op">=</span> <span class="st">"(.+?)_(.*)"</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># note events are not meta events (cf.</span>
  <span class="co"># https://mido.readthedocs.io/en/latest/midi_files.html?highlight=meta#meta-messages):</span>
  <span class="fu">mutate</span><span class="op">(</span>meta <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="join-non-note-events" class="section level3">
<h3 class="hasAnchor">
<a href="#join-non-note-events" class="anchor"></a>Join non note events</h3>
<p>We can now add the non note events:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_notes_out</span> <span class="op">&lt;-</span>
  <span class="va">df_notes_out</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">full_join</span><span class="op">(</span><span class="va">df_meta</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">full_join</span><span class="op">(</span><span class="va">df_not_notes</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># It is important to put the events in the right order:</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">i_track</span>, <span class="va">ticks</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">i_track</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># Now we can calculate the time increments between events;</span>
  <span class="co"># The first event of each track is set to 0:</span>
  <span class="fu">mutate</span><span class="op">(</span>time <span class="op">=</span> <span class="va">ticks</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">ticks</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> <span class="op">{</span><span class="va">.</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span>; <span class="va">.</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("i_track", "i_note", "type", "time", "ticks", "t", "m", "b", "meta")</span>
<span class="co">#&gt; Joining, by = c("i_track", "channel", "note", "i_note", "type", "time", "velocity", "ticks", "t", "m", "b", "meta", "track")</span>

<span class="va">df_notes_out</span>
<span class="co">#&gt; # A tibble: 268 × 19</span>
<span class="co">#&gt;    i_track channel  note i_note type       time velocity ticks     t     m     b</span>
<span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1       0       9    43      1 note_on       0       72     0 0      0        0</span>
<span class="co">#&gt;  2       0       9    39      1 note_on       0       64     0 0      0        0</span>
<span class="co">#&gt;  3       0       9    36      1 note_on       0      101     0 0      0        0</span>
<span class="co">#&gt;  4       0      NA    NA      0 track_na…     0       NA     0 0      0        0</span>
<span class="co">#&gt;  5       0      NA    NA      0 set_tempo     0       NA     0 0      0        0</span>
<span class="co">#&gt;  6       0      NA    NA      0 time_sig…     0       NA     0 0      0        0</span>
<span class="co">#&gt;  7       0       9    43      1 note_off    240       72   240 0.167  0.25     1</span>
<span class="co">#&gt;  8       0       9    39      1 note_off      0       64   240 0.167  0.25     1</span>
<span class="co">#&gt;  9       0       9    36      1 note_off      0      101   240 0.167  0.25     1</span>
<span class="co">#&gt; 10       0       9    42      1 note_on     240      101   480 0.333  0.5      2</span>
<span class="co">#&gt; # … with 258 more rows, and 8 more variables: meta &lt;lgl&gt;, name &lt;list&gt;,</span>
<span class="co">#&gt; #   tempo &lt;dbl&gt;, numerator &lt;dbl&gt;, denominator &lt;dbl&gt;, clocks_per_click &lt;dbl&gt;,</span>
<span class="co">#&gt; #   notated_32nd_notes_per_beat &lt;dbl&gt;, track &lt;chr&gt;</span></code></pre></div>
<p>The <code>time</code> value in midi format is given by the number of ticks passed between events.</p>
</div>
<div id="write-midi-dataframe-back-to-a-midi-file" class="section level3">
<h3 class="hasAnchor">
<a href="#write-midi-dataframe-back-to-a-midi-file" class="anchor"></a>Write midi dataframe back to a midi file</h3>
<p>Now we can transform the data back to a dataframe of the same format as the one we got with <code>miditapyr$midi_to_df()</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfc2</span> <span class="op">&lt;-</span>
  <span class="va">df_notes_out</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># For midi export the new columns are removed:</span>
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="co"># When reticulate converts R dataframes to pandas, there are complications</span>
  <span class="co"># with character columns containing missing values.</span>
  <span class="co"># repair_reticulate_conversion = TRUE, repairs that in the miditapyr python</span>
  <span class="co"># code:</span>
  <span class="va">miditapyr</span><span class="op">$</span><span class="fu">compact_df</span><span class="op">(</span>repair_reticulate_conversion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">dfc2</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 268 × 3</span>
<span class="co">#&gt;    i_track meta  msg             </span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;list&gt;          </span>
<span class="co">#&gt;  1       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt;  2       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt;  3       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt;  4       0 TRUE  &lt;named list [3]&gt;</span>
<span class="co">#&gt;  5       0 TRUE  &lt;named list [3]&gt;</span>
<span class="co">#&gt;  6       0 TRUE  &lt;named list [6]&gt;</span>
<span class="co">#&gt;  7       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt;  8       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt;  9       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt; 10       0 FALSE &lt;named list [5]&gt;</span>
<span class="co">#&gt; # … with 258 more rows</span></code></pre></div>
<p>And we can save it back to a midi file:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfc2</span> <span class="op"><a href="reference/%&gt;%.html">%&gt;%</a></span>
  <span class="va">miditapyr</span><span class="op">$</span><span class="fu">df_to_midi</span><span class="op">(</span><span class="va">ticks_per_beat</span>,
                <span class="st">"test.mid"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="related-r-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#related-r-packages" class="anchor"></a>Related R packages</h2>
<ul>
<li>The <a href="https://github.com/ColinFay/noon">noon package</a> wraps node.js libraries and can be used to read live midi input port data. I wrote a small <a href="https://urssblogg.netlify.app/post/2020-10-24-live-recording-of-a-midi-controller-via-mido-inport/">blog post</a> how reading a midi port can also be done in R with <a href="https://mido.readthedocs.io/en/latest/ports.html">mido</a>. Interestingly, the node.js libraries and mido rely on a the same C++ library <a href="http://www.music.mcgill.ca/~gary/rtmidi/index.html">RtMidi</a>.</li>
<li>The <a href="https://cran.r-project.org/package=tuneR">tuneR</a> package can also read in midi data. See the <a href="https://urswilke.github.io/pyramidi/articles/tuner.html">vignette</a>, for an example how you can transform the tuner format into the pyramidi format (or run <code><a href="articles/tuner.html">vignette("tuner", package = "pyramidi")</a></code> to load the vignette on your machine).</li>
</ul>
<!-- 
The following as well as the bibtex file "pkg-refs.bib" were automatically
created with the commands:
library(grateful)
pkgs <- scan_packages()
# don't know why including "R" gives an error ??
pkgs <- pkgs[!pkgs %in% c("R", "pyramidi")]
cites <- get_citations(pkgs)
rmd <- create_rmd(cites)

-> then copy the list in the created refs.Rmd below

-->
</div>
<div id="r-packages-used" class="section level2">
<h2 class="hasAnchor">
<a href="#r-packages-used" class="anchor"></a>R packages used</h2>
<p>This package stands on the shoulders of giants. It was only possible thanks to the following libraries:</p>
<ul>
<li>base (R Core Team 2021)</li>
<li>pkgdown (Wickham and Hesselberth 2020)</li>
<li>usethis (Wickham, Bryan, and Barrett 2021)</li>
<li>dplyr (Wickham et al. 2021)</li>
<li>forcats (Wickham 2021a)</li>
<li>tibble (Müller and Wickham 2021)</li>
<li>tidyr (Wickham 2021c)</li>
<li>pichor (Andersen 2021)</li>
<li>rvest (Wickham 2021b)</li>
<li>tidyverse (Wickham et al. 2019)</li>
<li>reticulate (Ushey, Allaire, and Tang 2021)</li>
<li>purrr (Henry and Wickham 2020)</li>
<li>stringr (Wickham 2019)</li>
<li>ggplot2 (Wickham 2016)</li>
<li>zeallot (Teetor 2018)</li>
<li>magrittr (Bache and Wickham 2020)</li>
<li>rlang (Henry and Wickham 2021)</li>
<li>knitr (Xie 2014)</li>
<li>rmarkdown (Xie, Dervieux, and Riederer 2020)</li>
<li>tuneR (Ligges et al. 2018)</li>
<li>testthat (Wickham 2011)</li>
<li>covr (Hester 2020)</li>
</ul>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-pichor" class="csl-entry">
<p>Andersen, Mikkel Meyer. 2021. <em>Pichor: Piano Chords in r</em>.</p>
</div>
<div id="ref-magrittr" class="csl-entry">
<p>Bache, Stefan Milton, and Hadley Wickham. 2020. <em>Magrittr: A Forward-Pipe Operator for r</em>. <a href="https://CRAN.R-project.org/package=magrittr" class="uri">https://CRAN.R-project.org/package=magrittr</a>.</p>
</div>
<div id="ref-purrr" class="csl-entry">
<p>Henry, Lionel, and Hadley Wickham. 2020. <em>Purrr: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr" class="uri">https://CRAN.R-project.org/package=purrr</a>.</p>
</div>
<div id="ref-rlang" class="csl-entry">
<p>———. 2021. <em>Rlang: Functions for Base Types and Core r and ’Tidyverse’ Features</em>. <a href="https://CRAN.R-project.org/package=rlang" class="uri">https://CRAN.R-project.org/package=rlang</a>.</p>
</div>
<div id="ref-covr" class="csl-entry">
<p>Hester, Jim. 2020. <em>Covr: Test Coverage for Packages</em>. <a href="https://CRAN.R-project.org/package=covr" class="uri">https://CRAN.R-project.org/package=covr</a>.</p>
</div>
<div id="ref-tuneR" class="csl-entry">
<p>Ligges, Uwe, Sebastian Krey, Olaf Mersmann, and Sarah Schnackenberg.</p>
<ol>
<li>
<em><span class="nocase">tuneR</span>: Analysis of Music and Speech</em>. <a href="https://CRAN.R-project.org/package=tuneR" class="uri">https://CRAN.R-project.org/package=tuneR</a>.</li>
</ol>
</div>
<div id="ref-tibble" class="csl-entry">
<p>Müller, Kirill, and Hadley Wickham. 2021. <em>Tibble: Simple Data Frames</em>. <a href="https://CRAN.R-project.org/package=tibble" class="uri">https://CRAN.R-project.org/package=tibble</a>.</p>
</div>
<div id="ref-base" class="csl-entry">
<p>R Core Team. 2021. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-zeallot" class="csl-entry">
<p>Teetor, Nathan. 2018. <em>Zeallot: Multiple, Unpacking, and Destructuring Assignment</em>. <a href="https://CRAN.R-project.org/package=zeallot" class="uri">https://CRAN.R-project.org/package=zeallot</a>.</p>
</div>
<div id="ref-reticulate" class="csl-entry">
<p>Ushey, Kevin, JJ Allaire, and Yuan Tang. 2021. <em>Reticulate: Interface to ’Python’</em>. <a href="https://CRAN.R-project.org/package=reticulate" class="uri">https://CRAN.R-project.org/package=reticulate</a>.</p>
</div>
<div id="ref-testthat" class="csl-entry">
<p>Wickham, Hadley. 2011. “Testthat: Get Started with Testing.” <em>The R Journal</em> 3: 5–10. <a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf" class="uri">https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf</a>.</p>
</div>
<div id="ref-ggplot2" class="csl-entry">
<p>———. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org" class="uri">https://ggplot2.tidyverse.org</a>.</p>
</div>
<div id="ref-stringr" class="csl-entry">
<p>———. 2019. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr" class="uri">https://CRAN.R-project.org/package=stringr</a>.</p>
</div>
<div id="ref-forcats" class="csl-entry">
<p>———. 2021a. <em>Forcats: Tools for Working with Categorical Variables (Factors)</em>. <a href="https://CRAN.R-project.org/package=forcats" class="uri">https://CRAN.R-project.org/package=forcats</a>.</p>
</div>
<div id="ref-rvest" class="csl-entry">
<p>———. 2021b. <em>Rvest: Easily Harvest (Scrape) Web Pages</em>. <a href="https://CRAN.R-project.org/package=rvest" class="uri">https://CRAN.R-project.org/package=rvest</a>.</p>
</div>
<div id="ref-tidyr" class="csl-entry">
<p>———. 2021c. <em>Tidyr: Tidy Messy Data</em>. <a href="https://CRAN.R-project.org/package=tidyr" class="uri">https://CRAN.R-project.org/package=tidyr</a>.</p>
</div>
<div id="ref-tidyverse" class="csl-entry">
<p>Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the <span class="nocase">tidyverse</span>.” <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686" class="uri">https://doi.org/10.21105/joss.01686</a>.</p>
</div>
<div id="ref-usethis" class="csl-entry">
<p>Wickham, Hadley, Jennifer Bryan, and Malcolm Barrett. 2021. <em>Usethis: Automate Package and Project Setup</em>. <a href="https://CRAN.R-project.org/package=usethis" class="uri">https://CRAN.R-project.org/package=usethis</a>.</p>
</div>
<div id="ref-dplyr" class="csl-entry">
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2021. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
<div id="ref-pkgdown" class="csl-entry">
<p>Wickham, Hadley, and Jay Hesselberth. 2020. <em>Pkgdown: Make Static HTML Documentation for a Package</em>. <a href="https://CRAN.R-project.org/package=pkgdown" class="uri">https://CRAN.R-project.org/package=pkgdown</a>.</p>
</div>
<div id="ref-knitr" class="csl-entry">
<p>Xie, Yihui. 2014. “Knitr: A Comprehensive Tool for Reproducible Research in R.” In <em>Implementing Reproducible Computational Research</em>, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. <a href="http://www.crcpress.com/product/isbn/9781466561595" class="uri">http://www.crcpress.com/product/isbn/9781466561595</a>.</p>
</div>
<div id="ref-rmarkdown" class="csl-entry">
<p>Xie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. <em>R Markdown Cookbook</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://bookdown.org/yihui/rmarkdown-cookbook" class="uri">https://bookdown.org/yihui/rmarkdown-cookbook</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/urswilke/pyramidi/">https://​github.com/​urswilke/​pyramidi/​</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Urs Wilke <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7257-2524" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/github/urswilke/pyramidi"><img src="https://travis-ci.org/urswilke/pyramidi.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/urswilke/pyramidi?branch=master"><img src="https://codecov.io/gh/urswilke/pyramidi/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/urswilke/pyramidi/actions"><img src="https://github.com/urswilke/pyramidi/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Urs Wilke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
